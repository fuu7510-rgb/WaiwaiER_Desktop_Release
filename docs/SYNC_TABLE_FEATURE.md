# 同期テーブル機能

## 概要

同期テーブル機能は、AppSheetの「同じテーブルを複数回読み込む」機能を再現したものです。

ER図上で同じテーブルを複数の場所に配置することで、リレーションの線が交錯して見づらくなる問題を解決します。

## 仕組み

- 同期テーブルは、元のテーブルと**カラム構造を共有**します
- 一方のテーブルでカラムを追加・削除・変更すると、同期グループ内の他のテーブルにも自動的に反映されます
- 各テーブルは**独自の位置、名前、色**を持つことができます
- **リレーション（Ref参照先）は独立**しています。同期テーブルごとに異なるテーブルへのリレーションを設定できます

## 使い方

### 同期テーブルの作成

1. ER図上でテーブルを選択
2. 右パネルの「テーブル設定」で「**同期テーブルを作成**」ボタンをクリック
3. 新しい同期テーブルが元のテーブルの近くに配置されます

### 同期テーブルの識別

- 同期テーブルのヘッダーには「**同期**」バッジが表示されます
- テーブル設定パネルに同期グループ情報が表示されます

### 同期の解除

1. 同期を解除したいテーブルを選択
2. 右パネルの「テーブル設定」で「**同期を解除**」ボタンをクリック
3. テーブルは独立したテーブルになり、カラムは新しいIDで再作成されます

## 同期される内容

| 項目 | 同期される | 備考 |
|------|------------|------|
| カラム名 | ✅ | |
| カラム型 | ✅ | |
| カラム順序 | ✅ | |
| カラム追加/削除 | ✅ | |
| isKey / isLabel | ✅ | |
| AppFormula | ✅ | |
| dummyValues | ✅ | |
| appSheet設定 | ✅ | |
| Ref参照先 | ❌ | 各テーブルで独立 |
| テーブル名 | ❌ | 各テーブルで独立 |
| テーブル色 | ❌ | 各テーブルで独立 |
| テーブル位置 | ❌ | 各テーブルで独立 |
| サンプルデータ | ❌ | 各テーブルで独立 |

## 技術的な実装

### データ構造

```typescript
interface Table {
  // ... 既存のフィールド
  
  /**
   * 同期テーブルグループID。
   * 同じsyncGroupIdを持つテーブルはカラム構造を共有。
   */
  syncGroupId?: string;
  
  /**
   * 同期グループのソーステーブルかどうか。
   */
  isSyncSource?: boolean;
}
```

### ソーステーブル

- 同期グループ内で最初に作成されたテーブル（または同期グループを作成したテーブル）
- `isSyncSource: true` が設定される
- ソーステーブルが削除された場合、残りのテーブルも同期が解除される（1つしか残らない場合）

### カラムID共有

同期テーブル間ではカラムIDが共有されます。これにより：

- カラムの更新が正しく同期される
- カラムの順序変更が同期される
- カラムの削除が同期される

### 同期解除時の動作

同期を解除すると：

1. カラムに新しいIDが割り当てられる
2. `syncGroupId` と `isSyncSource` がクリアされる
3. グループに1つしかテーブルが残らない場合、残りのテーブルも自動的に同期解除される
