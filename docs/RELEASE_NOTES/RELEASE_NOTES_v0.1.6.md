# WaiwaiER Desktop リリースノート

## 概要
- チャネル: ALPHA
- 対象OS: Windows
- 配布ZIP（NSIS）: WaiwaiER-Desktop-0.1.6-alpha-win64-nsis.zip
- GitHub Releases（このリポジトリのReleasesページ）からダウンロード
  - 配布ZIP（MSI）: WaiwaiER-Desktop-0.1.6-alpha-win64-msi.zip
- ERエディタ: リレーションを選択して編集できる機能を追加
  - 線（エッジ）クリックでリレーションを選択
  - サイドバー右ペインに「リレーション設定」パネルを追加
  - 線ラベル（自動/非表示/カスタム）をリレーションごとに設定可能
  - 線の種類（実線/破線/点線）をリレーションごとに設定可能
  - 線アニメーション（デフォルト/ON/OFF）をリレーションごとに設定可能
  - 追従アイコン表示（デフォルト/ON/OFF）をリレーションごとに設定可能
- ユーザー設定: リレーション線上の追従アイコン設定を追加
  - 追従アイコンの表示ON/OFF、アイコン種別（Lucide）、サイズ、速度
  - アイコン検索付きピッカー（IconPicker）を追加
  - 配布ZIP（NSIS）: WaiwaiER-Desktop-0.1.6-alpha-win64-nsis.zip
- ERエディタ: 破線/点線の表示とアニメーションを改善
  - React Flowの標準アニメーションでは周期が合わずギクシャクしやすいため、破線/点線のみ独自のdashoffsetアニメーションを適用
- 内部: 互換レイヤー（スキーマ正規化）でリレーションの表示設定を取り込み
  - `edgeLineStyle` / `edgeAnimationEnabled` / `edgeFollowerIconEnabled`
- アップデート前バックアップ推奨: 更新前に必ずエクスポート（JSON/パッケージ）などでバックアップしてください。

- ERエディタ: テーブル/カラム削除に伴い、選択中リレーションが不整合で残る場合がある問題を修正
  - 削除対象に紐づくリレーションが消えた場合、選択状態（selectedRelationId）をクリア
## インストール
1. 配布ZIP（MSI/NSIS）を展開
2. 展開したインストーラを実行
  - MSI版: `.msi`
  - NSIS版: `.exe`

## 変更点
### 追加
- ユーザー設定: ショートカットキー設定機能を追加
  - 各操作にカスタムキーボードショートカットを割り当て可能
  - 設定ダイアログに「ショートカットキー」セクションを追加
  - カテゴリ別に整理（ファイル/編集/表示/ナビゲーション）
  - クリックして新しいキーを押すことで変更可能
  - 「デフォルトに戻す」ボタンで全てリセット可能
  - 対応操作: プロジェクトを開く、保存、インポート、エクスポート、設定、元に戻す、やり直し、テーブル追加、サイドバー切替、グリッド切替、メモ切替、関連強調切替、拡大/縮小、全体表示、エディタ/シミュレーター切替
- ERエディタ: カラムをコピー（複製）する機能を追加
  - 選択中カラム行のミニツールバーに「コピー」アイコンを追加（Key/Label の左、上下2段つなげて表示）
  - 同一テーブル内で元カラムの直下に複製し、複製後カラムを自動選択
- ユーザー設定: エッジのアニメーションをON/OFFできる設定を追加（デフォルト: ON）
- ERエディタ: アニメーションを一時停止できるボタンを追加（設定値は変更しない）
- ERエディタ: リレーションをクリックして選択できる機能を追加
  - 選択中はサイドバーに「リレーション設定」を表示
  - 線ラベル: 自動/非表示/カスタムを切り替え可能
  - 線アニメーション: デフォルト（ユーザー設定）/ON/OFF をリレーションごとに設定可能
  - 追従アイコン: デフォルト（ユーザー設定）/ON/OFF をリレーションごとに設定可能
- ERエディタ: リレーション線の表示スタイル（実線/破線/点線）を追加
- ERエディタ: リレーション線上を移動する「追従アイコン」を追加
  - ユーザー設定でON/OFF、アイコン、サイズ、速度を調整可能
  - アイコンはLucideから検索して選択可能（IconPicker）
  - リレーションごとにON/OFFを上書き可能
- JSONインポート: インポートモード選択機能を追加
  - 上書きインポート: 既存データを置き換え（従来の動作）
  - 追加インポート: 既存データに新しいテーブル・リレーション・メモを追加
  - 追加インポート時はIDを自動で振り直して重複を回避
  - 追加されたテーブルは自動的に選択状態になり、まとめて移動可能

### 改善
- ERエディタ: 選択中のテーブル/カラム/リレーション（線）を Delete キーで削除できるように改善
  - 誤操作防止のため Backspace では削除しない
- ERエディタ: ER図のDnD・ズーム・カラム選択時のパフォーマンス改善（再レンダー抑制）
- ERエディタ: カラムの接続ハンドル（円）のサイズ/位置を微調整（より小さく・位置ずれ抑制）
- ERエディタ: テーブルの枠線を 2px に調整
- ERエディタ: 選択状態/購読の最適化（パフォーマンス改善）
- ERエディタ: テーブル一覧の行の上下余白を小さくして一覧性を改善
- ERエディタ: 破線/点線のアニメーションを独自dashoffsetで調整し、表示のギクシャク感を軽減
- ERエディタ: 選択中リレーションを強調表示（線の見分けやすさを改善）
- ERエディタ: マルチセレクトしたノードをまとめてドラッグした際、すべてのノードの位置を保存するように改善
- ユーザー設定: 設定ダイアログの項目を整理（一般/リレーション設定の折りたたみ）
- シミュレーター/共通UI: テーマCSS変数を使用するように調整し、ダークモード時の視認性を改善
  - Form View / Detail View / 関連レコード / ダイアログ / リサイズスプリッター など
- JSONインポート: ダイアログのスタイルをダークモード対応に改善
- 内部: 互換レイヤー（スキーマ正規化）でリレーションの表示設定を読み込み
  - `edgeLineStyle` / `edgeAnimationEnabled` / `edgeFollowerIconEnabled`
- 内部: 図の保存スキーマの互換性を改善（スキーマv3）
  - 不完全な旧データの救済（tables/relations/memos のいずれかが存在し配列なら受理）
  - 将来の `schemaVersion`（新しいアプリで作られたデータ）でも、読める範囲は正規化して読み込み
- プロジェクト: プロジェクトダイアログにアプリバージョン/データスキーマバージョンを表示
- プロジェクト: 保存時にデータスキーマバージョンを記録し、古いデータに警告を表示
  - プロジェクトを開いて保存することで最新版へ更新
- 内部: DB抽象化レイヤーを `src/lib/database/` 配下に分割し、保守性を改善
  - `src/lib/database.ts` は後方互換のためのエイリアス
- 内部: 設定ダイアログ（SettingsDialog）をリファクタリングし、保守性を改善
  - 1378行 → 75行へ大幅に簡素化
  - 各設定セクションを `src/components/Settings/sections/` に分割（10コンポーネント）
  - 共通の折りたたみUI を `SettingsCollapsibleSection` として共通化
  - ショートカットキー編集ロジックを `src/hooks/useShortcutEditor.ts` に切り出し
  - 設定インポート/エクスポートのバリデーションを `src/lib/settings/` に分離（テスト可能化）
  - CSS変数 `--accent-*`, `--danger` を追加し、テーマ対応を強化
- ユーザー設定: 設定ダイアログを2カラム構成にリニューアル
  - 左サイドバー: セクション名をグループ別（基本設定/詳細設定/情報）にアイコン付きで表示
  - 右コンテンツエリア: 選択されたセクションの設定内容を表示
  - ワンクリックでセクション切り替え可能（スクロール不要）
  - 折りたたみ式UIを廃止し、常にすべてのセクションへアクセス可能
  - 設定インポート/エクスポート機能を「一般」セクションに統合
  - ダイアログサイズを拡大し、より広い作業領域を確保
- エクスポート: AI開発駆動向けSQL/Markdownエクスポート機能を追加
  - DDL（CREATE TABLE文）出力: SQLダイアレクト対応（汎用SQL/MySQL/PostgreSQL/SQLite）
  - 外部キー制約・コメント・DROP TABLE の有無をオプションで切り替え可能
  - テーブル依存関係を考慮したトポロジカルソート出力
  - Markdown（データ）出力: サンプルデータをMarkdownテーブル形式で出力
  - Markdown（スキーマ）出力: カラム名・型・Key/FK・必須・説明をテーブル形式で出力
  - ヘッダーの `</>` アイコンボタンからアクセス可能

### 修正
- ERエディタ: カラム行ミニツールバーが他のテーブルの下に入ってクリックできない場合がある問題を修正
  - ミニツールバー表示中（選択中）のテーブルが常に最前面になるように調整
- ERエディタ: テーブル/カラム削除に伴い、選択中リレーションが不整合で残る場合がある問題を修正
  - 削除対象に紐づくリレーションが消えた場合、選択状態（selectedRelationId）をクリア
- ERエディタ: 追従アイコンのフォールバックが DynamicIcon と互換にならない場合がある問題を修正
- ERエディタ: 関連強調ONでテーブルの枠線が一部破線になる問題を修正（すべて実線に統一）

## 既知の制限
- ALPHAのため、互換性（DB/プロジェクト形式）が将来変更される可能性があります。

## 不具合報告
- 手順/期待/実際の結果、OS、バージョン（設定→バージョン情報の値）を添えて連絡
- 連絡先: GitHub Issues（配布用Publicリポジトリ）
- 注意: Issuesは公開されます。個人情報・社外秘情報・顧客データ等は記載しないでください。
